name: install argocd
on: 
  workflow_dispatch:
  push:
    paths:
      - "argocd/**"

env:
  ARGOCD_NAMESPACE: argocd


jobs:
  deployment:
    name: Deploy
    runs-on: ubuntu-latest
    environment: prod
    steps:
      # Install ArgoCD
      # Upload argocd-initial-admin-secret to GitHub
    # docs: https://github.com/actions-hub/kubectl
    - uses: actions-hub/kubectl@master
      env:
        KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}
      with:
        args: create namespace ${{ env.ARGOCD_NAMESPACE }}
    - uses: actions-hub/kubectl@master
      env:
        KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}
      with:
        args: apply -n ${{ env.ARGOCD_NAMESPACE }} -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
